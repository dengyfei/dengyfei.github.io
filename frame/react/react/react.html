<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>react | 小邓同学</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/style.css">
    <meta name="description" content="点赞、转发、收藏">
    <meta name="keywords" content="小邓聊前端,vuepress,自建博客,小邓同学">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="author" content="小邓同学">
    
    <link rel="preload" href="/assets/css/0.styles.9cc53e28.css" as="style"><link rel="preload" href="/assets/js/app.b627ab70.js" as="script"><link rel="preload" href="/assets/js/4.b7ac1ab4.js" as="script"><link rel="preload" href="/assets/js/1.9d26e7c2.js" as="script"><link rel="preload" href="/assets/js/10.a2a3a23e.js" as="script"><link rel="preload" href="/assets/js/16.d6e6d53e.js" as="script"><link rel="prefetch" href="/assets/js/11.98134433.js"><link rel="prefetch" href="/assets/js/12.61792e8a.js"><link rel="prefetch" href="/assets/js/13.193f9307.js"><link rel="prefetch" href="/assets/js/14.4f55412f.js"><link rel="prefetch" href="/assets/js/15.312bab3c.js"><link rel="prefetch" href="/assets/js/17.f15a0a2d.js"><link rel="prefetch" href="/assets/js/18.77f54671.js"><link rel="prefetch" href="/assets/js/19.b653579d.js"><link rel="prefetch" href="/assets/js/20.e191a925.js"><link rel="prefetch" href="/assets/js/21.405c21a4.js"><link rel="prefetch" href="/assets/js/5.75731db2.js"><link rel="prefetch" href="/assets/js/6.6027367b.js"><link rel="prefetch" href="/assets/js/7.f626a356.js"><link rel="prefetch" href="/assets/js/8.9cf2c28d.js"><link rel="prefetch" href="/assets/js/9.f39c5c6b.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.7646b3f8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9cc53e28.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="theme-container" data-v-4698c43e><div data-v-4698c43e><div id="loader-wrapper" class="loading-wrapper" data-v-1c4f0192 data-v-4698c43e data-v-4698c43e><div class="loader-main" data-v-1c4f0192><div data-v-1c4f0192></div><div data-v-1c4f0192></div><div data-v-1c4f0192></div><div data-v-1c4f0192></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-6cbeab0a data-v-4698c43e data-v-4698c43e><h3 class="title" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a>小邓同学</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a><input type="password" value="" data-v-6cbeab0a> <span data-v-6cbeab0a>Konck! Knock!</span> <button data-v-6cbeab0a>OK</button></label> <div class="footer" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a><span data-v-6cbeab0a><i class="iconfont reco-theme" data-v-6cbeab0a></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-6cbeab0a>vuePress-theme-reco</a></span> <span data-v-6cbeab0a><i class="iconfont reco-copyright" data-v-6cbeab0a></i> <a data-v-6cbeab0a><span data-v-6cbeab0a>小邓同学</span>
            
          <span data-v-6cbeab0a>2022 - </span>
          2023
        </a></span></div></div> <div class="hide" data-v-4698c43e><header class="navbar" data-v-4698c43e><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">小邓同学</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-eye"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-api"></i>
      前端框架
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>React</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frame/react/react/react.html" aria-current="page" class="nav-link router-link-exact-active router-link-active"><i class="iconfont undefined"></i>
  React基础
</a></li><li class="dropdown-subitem"><a href="/frame/react/redux/redux.html" class="nav-link"><i class="iconfont undefined"></i>
  Redux
</a></li><li class="dropdown-subitem"><a href="/frame/react/router/router.html" class="nav-link"><i class="iconfont undefined"></i>
  React router v5
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-faq"></i>
      前端基础
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/basic/css/sass.html" class="nav-link"><i class="iconfont undefined"></i>
  css
</a></li><li class="dropdown-item"><!----> <a href="/basic/webpack/webpack.html" class="nav-link"><i class="iconfont undefined"></i>
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/basic/babel/babel.html" class="nav-link"><i class="iconfont undefined"></i>
  babel
</a></li><li class="dropdown-item"><!----> <a href="/basic/git/git.html" class="nav-link"><i class="iconfont undefined"></i>
  git
</a></li></ul></div></div><div class="nav-item"><a href="/frame/react/react/algorithm/algorithm.html" class="nav-link"><i class="iconfont undefined"></i>
  算法
</a></div><div class="nav-item"><a href="https://github.com/dengyfei" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-blog"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-4698c43e></div> <aside class="sidebar" data-v-4698c43e><div class="personal-info-wrapper" data-v-6c8ffc9c><img src="/avatar.png" alt="author-avatar" class="personal-img" data-v-6c8ffc9c> <h3 class="name" data-v-6c8ffc9c>
    小邓同学
  </h3> <div class="num" data-v-6c8ffc9c><div data-v-6c8ffc9c><h3 data-v-6c8ffc9c>9</h3> <h6 data-v-6c8ffc9c>文章</h6></div> <div data-v-6c8ffc9c><h3 data-v-6c8ffc9c>10</h3> <h6 data-v-6c8ffc9c>标签</h6></div></div> <hr data-v-6c8ffc9c></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-eye"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-api"></i>
      前端框架
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>React</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frame/react/react/react.html" aria-current="page" class="nav-link router-link-exact-active router-link-active"><i class="iconfont undefined"></i>
  React基础
</a></li><li class="dropdown-subitem"><a href="/frame/react/redux/redux.html" class="nav-link"><i class="iconfont undefined"></i>
  Redux
</a></li><li class="dropdown-subitem"><a href="/frame/react/router/router.html" class="nav-link"><i class="iconfont undefined"></i>
  React router v5
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-faq"></i>
      前端基础
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/basic/css/sass.html" class="nav-link"><i class="iconfont undefined"></i>
  css
</a></li><li class="dropdown-item"><!----> <a href="/basic/webpack/webpack.html" class="nav-link"><i class="iconfont undefined"></i>
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/basic/babel/babel.html" class="nav-link"><i class="iconfont undefined"></i>
  babel
</a></li><li class="dropdown-item"><!----> <a href="/basic/git/git.html" class="nav-link"><i class="iconfont undefined"></i>
  git
</a></li></ul></div></div><div class="nav-item"><a href="/frame/react/react/algorithm/algorithm.html" class="nav-link"><i class="iconfont undefined"></i>
  算法
</a></div><div class="nav-item"><a href="https://github.com/dengyfei" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-blog"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>react</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frame/react/react/react.html" aria-current="page" class="active sidebar-link">react</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frame/react/react/react.html#初识-react" class="sidebar-link">初识 React</a></li><li class="sidebar-sub-header"><a href="/frame/react/react/react.html#启动项目" class="sidebar-link">启动项目</a></li><li class="sidebar-sub-header"><a href="/frame/react/react/react.html#组件化开发" class="sidebar-link">组件化开发</a></li><li class="sidebar-sub-header"><a href="/frame/react/react/react.html#状态管理" class="sidebar-link">状态管理</a></li><li class="sidebar-sub-header"><a href="/frame/react/react/react.html#生命周期" class="sidebar-link">生命周期</a></li><li class="sidebar-sub-header"><a href="/frame/react/react/react.html#组件通信" class="sidebar-link">组件通信</a></li><li class="sidebar-sub-header"><a href="/frame/react/react/react.html#样式书写" class="sidebar-link">样式书写</a></li><li class="sidebar-sub-header"><a href="/frame/react/react/react.html#添加-class" class="sidebar-link">添加 class</a></li><li class="sidebar-sub-header"><a href="/frame/react/react/react.html#补充" class="sidebar-link">补充</a></li></ul></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-6cbeab0a data-v-4698c43e><h3 class="title" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a>react</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a><input type="password" value="" data-v-6cbeab0a> <span data-v-6cbeab0a>Konck! Knock!</span> <button data-v-6cbeab0a>OK</button></label> <div class="footer" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a><span data-v-6cbeab0a><i class="iconfont reco-theme" data-v-6cbeab0a></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-6cbeab0a>vuePress-theme-reco</a></span> <span data-v-6cbeab0a><i class="iconfont reco-copyright" data-v-6cbeab0a></i> <a data-v-6cbeab0a><span data-v-6cbeab0a>小邓同学</span>
            
          <span data-v-6cbeab0a>2022 - </span>
          2023
        </a></span></div></div> <div data-v-4698c43e><main class="page"><!----> <div class="page-title" style="display:none;"><h1>react</h1> <hr> <div data-v-484a899e><i class="iconfont reco-account" data-v-484a899e><span data-v-484a899e>小邓同学</span></i> <i class="iconfont reco-date" data-v-484a899e><span data-v-484a899e>2022-10-21 12:44:15</span></i> <!----> <i class="iconfont reco-tag tags" data-v-484a899e><span class="tag-item" data-v-484a899e>
      react
    </span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><div class="custom-block tip"><p>⭐️前言</p> <p>React 作为和 Vue、Angular 并驾齐驱的前端三大主流框架之一，其地位自然不言而喻。React 一直站在前端技术前沿，引领着前端发展。很多大厂都选择使用 React 作为日常开发的框架，很多程序员也都偏爱 React，主要原因在于 React 使用的是 JSX(一种酷似 JavaScript 的语言)编写，导致 React 的灵活性是其他两大框架所无法匹敌的。而且 Vue 和 Angular 中很多的思想都是借鉴 React。所以，每个致力于献身前端事业的小伙伴都是有必要了解 React 的。</p></div> <h2 id="初识-react"><a href="#初识-react" class="header-anchor">#</a> 初识 React</h2> <p>开发 React 必须依赖三个库：</p> <ul><li>react：包含 react 所必须的核心代码</li> <li>react-dom：react 渲染在不同平台所需要的核心代码</li> <li>babel：将 jsx 转换成 JavaScript 代码的工具</li></ul> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

  <span class="token comment">&lt;!-- 引入依赖 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span>
    <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://unpkg.com/react@18/umd/react.development.js<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">crossorigin</span>
  <span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span>
    <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://unpkg.com/react-dom@18/umd/react-dom.development.js<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">crossorigin</span>
  <span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://unpkg.com/babel-standalone@6/babel.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/babel<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token comment">//react@18之前</span>
    <span class="token comment">// ReactDOM.render(&lt;h2&gt;hello react&lt;/h2&gt;, document.querySelector('#root'))</span>

    <span class="token comment">//react@18版本</span>
    <span class="token keyword">const</span> root <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//创建一个根</span>
    <span class="token comment">//在根组件中渲染内容</span>
    root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>hello react<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>hello world<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="声明式编程"><a href="#声明式编程" class="header-anchor">#</a> 声明式编程</h3> <p>React 使用的是声明式编程，而虚拟 DOM 帮助我们从命令式编程转到声明式编程的模式。</p> <p>Virtual DOM(虚拟 DOM)是一种编程理念，UI 是以一种理想化或者说虚拟化的方式保存在内存中的，并且它是一个相对简单的 JavaScript 对象。我们可以通过<code>root.render</code>让虚拟 DOM 和真实 DOM 同步起来，这个过程称为协调。</p> <p><strong>React 渲染的整个流程：</strong>
首先我们编写的 jsx 代码会被 babel 解析成 React Element 对象，这就是虚拟 DOM，虚拟 DOM 实质就是普通的 JavaScript 对象。然后 react 会通过调用<code>root.render</code>函数让虚拟 DOM 同步为真实 DOM。</p> <h2 id="启动项目"><a href="#启动项目" class="header-anchor">#</a> 启动项目</h2> <p>实际项目开发中我们都会使用脚手架构建项目，比如 Vue 的 Vue-CLI， 而 React 使用的脚手架是<code>create-react-app</code>，并且默认使用<code>yarn</code>作为包管理工具(React18 改成了 npm)。因此，开发前我们需要执行以下命令在全局安装这两个工具：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm install <span class="token operator">-</span>g yarn
npm install <span class="token operator">-</span>g create<span class="token operator">-</span>react<span class="token operator">-</span>app
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>然后就可以执行下面命令创建一个 React 工程了：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>create<span class="token operator">-</span>react<span class="token operator">-</span>app 项目名
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>创建好的项目路径如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">public</span>
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> favicon<span class="token punctuation">.</span>ico
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>html
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> logo192<span class="token punctuation">.</span>png
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> logo512<span class="token punctuation">.</span>png
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> manifest<span class="token punctuation">.</span>json
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> robots<span class="token punctuation">.</span>txt
<span class="token operator">|</span>
<span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">--</span> src
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> App<span class="token punctuation">.</span>css
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> App<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> App<span class="token punctuation">.</span>test<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>css
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> index<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> logo<span class="token punctuation">.</span>svg
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> reportWebVitals<span class="token punctuation">.</span>js
<span class="token operator">|</span>   <span class="token operator">|</span><span class="token operator">--</span> setupTests<span class="token punctuation">.</span>js
<span class="token operator">|</span>
<span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> <span class="token keyword">package</span><span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">--</span> <span class="token constant">README</span><span class="token punctuation">.</span>md
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><ul><li><code>public</code>: 该目录下主要用于存放一些静态资源</li> <li><code>src/App.js</code>: App 组件相关的代码</li> <li><code>src/index.css</code>: 全局样式文件</li> <li><code>src/index.js</code>: 整个应用程序的入口文件
首先我们可以进入到全局入口文件<code>src/index.js</code>中，里面的主体代码大致是下面这样</li></ul> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom/client'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App'</span>

<span class="token keyword">const</span> root <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>可以看到，<code>src/index.js</code>中只做的事情很简单：</p> <ul><li>基于<code>id = root</code>的 DOM 元素创建一个根，</li> <li>调用 render 方法，将虚拟 DOM 协调成真实 DOM</li></ul> <p>接下来我们要做的，就是在 APP 组件中开发定制功能，而在 React 中，组件可以使用类和函数的方式开发。</p> <h2 id="组件化开发"><a href="#组件化开发" class="header-anchor">#</a> 组件化开发</h2> <div class="custom-block tip"><p>react 中有两种方式定义组件：类组件和函数式组件</p></div> <h3 id="类组件"><a href="#类组件" class="header-anchor">#</a> 类组件</h3> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'tom'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> </span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token plain-text"> </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="custom-block tip"><p>类组件的特点</p> <p>1、类组件必须继承 React.Component</p> <p>2、constructor 是可选的，通常用于初始化一些数据</p> <p>3、this.state 用于维护组件内的数据</p> <p>4、render 函数是类组件中唯一必须实现的方法</p></div> <h3 id="函数式组件"><a href="#函数式组件" class="header-anchor">#</a> 函数式组件</h3> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> hello react </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="custom-block tip"><p>函数式组件的特点</p> <p>1、没有生命周期函数</p> <p>2、没有 this 对象</p> <p>3、没有内部状态(state)</p></div> <div class="custom-block warning"><p>💡 注意: 对于定义在类组件的 render 函数，不支持显示对象类型的数据，以下代码，react 内部会抛出异常</p></div> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">app</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">person</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'tom'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>person<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><img src="/assets/img/react_error.462def45.png" alt="react_error"></p> <h3 id="类组件中的-this-问题"><a href="#类组件中的-this-问题" class="header-anchor">#</a> 类组件中的 this 问题</h3> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'hello world'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">btnClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'hello react'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>message<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>btnClick<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">改变</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>上面的代码想要实现的逻辑是：点击按钮，改变 state 中 message 的值，从而改变界面上的渲染。但是，当我们点击按钮时，我们会发现，控制台会报下面的错误：</p> <p><img src="/assets/img/this_error.3819a91c.png" alt="this_error"></p> <p>这个错误很明显提示我们 btnClick 中的 this 是<code>undefined</code>，这是为啥呢？因为 JavaScript 类对象默认使用的是严格模式，而严格模式下，使用默认方式调用函数且未明确指定 this 的情况下，该函数的 this 就是指向<code>undefined</code>。</p> <p>有以下方式可以解决 this 问题：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'hello world'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//方案一</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>btnClick <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">btnClick</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">btnClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'hello react'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>message<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span><span class="token comment">/*方案一*/</span><span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>btnClick<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">改变</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">

        </span><span class="token punctuation">{</span><span class="token comment">/*方案二*/</span><span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">btnClick</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">改变</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">

        </span><span class="token punctuation">{</span><span class="token comment">/*方案三*/</span><span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">btnClick</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">改变</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h2 id="状态管理"><a href="#状态管理" class="header-anchor">#</a> 状态管理</h2> <p>在类组件的<code>constructor函数</code>中，<code>this.state</code>对象被用来维护组件内的状态。在开发中，如果我们直接修改<code>state</code>，React 内部并不能检测到状态发生了变化，也就不会调用组件内部的 render 函数重新渲染界面。因此，React 推荐我们使用<code>setState函数</code>修改状态。<code>setState函数</code>并不需要我们定义，它是<code>React.Component</code>中的方法。</p> <p>为什么 React 当中要使用 setState 呢？因为 React 并没有像 Vue 那样实现双向绑定和数据劫持，所以 React 并不知道什么时候执行 render 函数将虚拟 DOM 同步成真实 DOM。所以，这个时候需要我们自己来调用 setState 函数通知 React 执行 render 函数。</p> <div class="custom-block tip"><p>setState 内部完成了两件事情：1、改变 state 对象，2、自动执行 render 函数</p></div> <div class="custom-block warning"><p><code>setState函数</code>要求传入两个参数。第一个参数是必须的，可以是一个对象或者函数，如果是一个函数，则必须返回一个对象。对象的属性表明要更新的数据。第二个参数是可选参数，要求传入一个函数，在该函数中可以获取本次更新后的状态。</p></div> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">app</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'tom'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'jake'</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>此时界面上依然展示的是 tom，而不是 jake，因为 React 并不知道此时的状态已然发生了改变，所以就不会执行 render 函数将虚拟 DOM 协调为真实 DOM。</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">app</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'tom'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'jake'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>setState 函数在改变状态之后会调用组件内部的 render 函数，因此此时界面上显示的是 jake。</p> <h3 id="setstate-是异步更新的"><a href="#setstate-是异步更新的" class="header-anchor">#</a> setState 是异步更新的</h3> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">app</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'tom'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">改变姓名</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">changeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'jake'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">)</span> <span class="token comment">// {name: tom, age:18}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>上面的代码执行后，即使界面上已经显示 jake 了，但是 setState 后面的打印却依旧是前一次的状态。可见 setState 是异步的。</p> <div class="custom-block danger"><p>setState 设置为异步的原因</p> <p><strong>1. 提升性能：</strong> 如果 setState 是同步的，那么每次调用 setState 都会立马更新，意味着 render 函数会被频繁调用，界面就会不断的重新渲染，这样的效率是很低的。</p> <p><strong>2.确保 state 和 props 保持同步：</strong> react 中的 render 函数会比 setState 稍慢一些，如果立即更新了 state，但还没执行 render 函数，即在 setState 函数刚刚执行完的那一刻，state 和 props 是一致的。</p></div> <p>但如果 setState 是异步的，我们什么时候才能获取到更新后的状态呢？这里提供两种方案。</p> <p><strong>通过回调函数。</strong> 前面提到过 setState 接收的第二个参数，这个参数需要传一个函数，并且在这个函数当中是可以获取到组件更新后的状态的。上面的代码如果这样写，就可以获取到最新的值</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token function">changeName</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'jake'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">)</span>  <span class="token comment">// {name: jake, age: 18}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>通过生命周期函数。</strong> 在 react 中，组件的状态更新后，都会立马调用<code>componentDidUpdate</code><a href="#1">生命周期函数</a>，在这个函数中也可以获取到组件本次更新的状态</p> <h3 id="setstate-数据的合并"><a href="#setstate-数据的合并" class="header-anchor">#</a> setState 数据的合并</h3> <p>上面例子中，我们通过 setState 更新组件状态时，传给了 setState 一个<code>{name: jake}</code> 的参数，参数里面并没有包含 age 属性，但是更新后的状态里面依旧包含了 age 属性。我们把 setState 的这种特性称为 <strong>setState 的数据合并。</strong> setState 数据合并的特性允许我们在调用 setState 函数的时候只需要传入本次需要更改的属性，而无需传入整个对象。</p> <p>那么为什么会有这种特性呢？这还得从 react 源码分析。react 在执行 setState 时，最后会通过<code>Object.assign</code>来合并数据的。比如上面的代码，react 内部最后会执行</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'jake'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这样，返回的对象中就既包含了<code>this.state</code>中的所有属性，也包含了本次更新的属性。</p> <h3 id="setstate-的合并"><a href="#setstate-的合并" class="header-anchor">#</a> setState 的合并</h3> <p>setState 除了有数据合并的特性，其本身也是具有合并特性的。</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">app</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">当前计数： </span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">增加</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>上面代码执行后，界面的数字是 2，而不是预期的 3。这是由于当多个连续<code>setState函数</code>传入的参数均为对象时，react 内部会把这些参数统一放到一个链表中，然后循环这个链表，执行下面操作来合并多个 setState 参数。</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token comment">/**
 * preState: 前一个setState函数
 * nextProps: 后一个setState函数
 */</span>
Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> preState<span class="token punctuation">,</span> nextProps<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>如此一来，当多个 setState 连续，且传入的对象的属性是一样的时候，只会执行最后一个 setState 中的改变。</p> <p>那么有没有一种办法不让连续的多个 setState 函数合并呢？当然是有的。之前提到过，setState 函数的第一个参数也可以是一个函数，这个函数接收两个参数，第一个是 state，表示上一次的状态；第二个参数是 props。</p> <div class="custom-block tip"><p>当 setState 传入的是一个函数时，react 内部就会依次执行每一个 setState 函数了</p></div> <p>所以上面的代码可以这样改写，使界面数字变为 3。</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token function">increment</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span> state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span> state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="setstate-的数据不可变性"><a href="#setstate-的数据不可变性" class="header-anchor">#</a> setState 的数据不可变性</h3> <p>react 建议除了构造函数(constructor)外，不应在任何地方修改<code>this.state</code>的值，即保证<code>this.state</code>中数据的不可变性。当使用<code>setState函数</code>更新状态时，我们通常都是<strong>重新声明一个变量，而不应主动修改 this.state 中的值</strong>。</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">friends</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'lilie'</span><span class="token punctuation">,</span> <span class="token string">'hanmeimei'</span><span class="token punctuation">,</span> <span class="token string">'lucy'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">添加朋友</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'tom'</span><span class="token punctuation">)</span> <span class="token comment">//错误的操作，改变了this.state中的数据</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">friends</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>friends<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>基于 setState 的数据不可变性，increment 函数体中应该重新声明一个变量，而不能直接更改 this.state 的值</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> newFriends <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">,</span> <span class="token string">'tom'</span><span class="token punctuation">]</span> <span class="token comment">//正确的操作，维持了this.state的不可变性</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">friends</span><span class="token operator">:</span> newFriends<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="生命周期"><a href="#生命周期" class="header-anchor">#</a> 生命周期</h2> <h4 id="1">首先来看下 React 官方给出的生命周期图谱</h4> <p><img src="/assets/img/life_cycle.3fadb6ff.png" alt="life_cycle"></p> <p>图谱指出，一个组件大体会经历三个阶段：</p> <div class="custom-block tip"><ul><li>挂载阶段(Mounting)：首先 react 会调用构造函数初始化状态，然后依次经历 getDerivedStateFromProps、render 函数并更新 DOM 节点和 refs，最后调用 componentDidMount 钩子</li></ul> <ul><li><p>更新阶段(Updating)：当改变传入组件的 props 或者调用 setState 函数时，先是通过 getDerivedStateFromProps，获取更新前后的 props 和 state，在 shouldComponentUpdate 钩子中判断更新前后的 props 和 state 是否发生变化，如果发生了变化，则更新界面，并执行 componentDidUpdate 钩子，否则，不刷新界面。</p></li> <li><p>卸载阶段(Unmounting)：直接执行 componentWillUnmount 钩子，然后卸载组件。</p></li></ul></div> <p>生命周期中的函数称为生命周期函数或生命周期钩子，在 React 的生命周期中，有几个生命周期函数是值得注意的。
<strong>1.constructor：</strong> 初始化状态。</p> <p><strong>2.componentDidMount：</strong> 组件挂载后立即调用。通常在该函数中执行某些依赖 DOM 的操作，比如网络请求或者添加一些订阅。</p> <p><strong>3.componentDidUpdate:</strong> 在组件的 props 或者 state 更新后立即调用。</p> <p><strong>4.componentWillUnmount:</strong> 在组件卸载及销毁之前调用。一般用于执行一些清理操作，比如清除订阅。</p> <p><strong>5.shouldComponentUpdate:</strong> 这个生命周期函数的作用是提高性能，减少不必要的渲染。</p> <p>shouldComponentUpdate 其实是通过控制是否调用 render 函数从而减少不必要的渲染来提高性能的。当一个组件 UI 界面所依赖的状态(包括 state 和 props)没有发生改变时，我们没有必要重新渲染组件。这个时候我们就需要通过 shouldComponentUpdate 函数控制组件不去调用组件的 render 函数。</p> <p>shouldComponentUpdate 函数接收两个参数：</p> <p>参数一：nextProps，表示修改之后最新的 props 属性</p> <p>参数二：nextState，表示修改之后最新的 state 属性</p> <div class="custom-block tip"><p>shouldComponentUpdate 函数返回的是一个 Boolean 值。如果返回的是 true，表明需要调用 render 函数；如果返回的是 false，表明不需要调用 render 方法。默认返回 true</p></div> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'hello world'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'tom'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'render函数更新了'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeVal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">改变</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">changeVal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'hello react'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>上面这段代码每次点击按钮，render 函数都会执行一遍并打印。但是我们细想一些，render 函数所依赖的 this.state.name 从始至终都未曾改变过，因此，这种情况下的 render 函数其实就没必要重复执行了。这个时候，我们就可以使用 shouldComponentUpdate 函数来控制 render 的执行。</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'hello world'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'tom'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span><span class="token parameter">nextProps<span class="token punctuation">,</span> nextState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>name <span class="token operator">!==</span> nextState<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'render函数更新了'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeVal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">改变</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">changeVal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'hello react'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>优化之后的代码只有当 UI 界面依赖的<code>this.state.name</code>(本次状态中的值)不等于<code>nextState.name</code>(更新后状态中的值)时，shouldComponentUpdate 函数才会返回 true，即允许 render 函数重新执行。否则，render 函数是不会重新执行的。</p> <h2 id="组件通信"><a href="#组件通信" class="header-anchor">#</a> 组件通信</h2> <p>在我们开发过程中，肯定会遇到许多的交互，比如点击某个按钮，界面弹出弹框。这个时候就需要组件间互相传递信息。React 中组件通信通常分为三类：父子组件通信、祖孙组件通信和全局事件传递。</p> <h3 id="父子组件通信"><a href="#父子组件通信" class="header-anchor">#</a> 父子组件通信</h3> <div class="custom-block tip"><p>父组件通过<code>属性=值</code>的形式来传递向子组件传递信息，而子组件则是通过 props 参数获取父组件传递过来的数据</p></div> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token punctuation">{</span>
  <span class="token comment">/*类组件*/</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">ChildCpn</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span><span class="token comment">/*子组件通过props接收父组件传递过来的参数*/</span><span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">当前计数：</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>curCount<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token punctuation">{</span>
  <span class="token comment">/*函数式组件*/</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">ChildCpn2</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">当前计数：</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>curCount<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">app</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span><span class="token comment">/*父组件通过'属性=值'的形式传递参数*/</span><span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ChildCpn</span></span> <span class="token attr-name">curCount</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ChildCpn2</span></span> <span class="token attr-name">curCount</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><p>我们有没有想过一个问题，我们并没有在组件实例(this)上挂载 props，那为什么我们可以在子组件中直接通过 this.props 访问父组件传递过来的参数呢？</p> <p>这个问题得用 React 源码来回答，我们声明的类组件都继承自 React 中的 Component，而在 React 中，我们可以找到它对 Component 的定义。
<img src="/assets/img/component.98cf5b40.png" alt="component">
从源码中我们可以看到，React 在其内部主动将传入的 props 挂载到了组件实例(this)上，这样我们就能直接通过 this.props 访问父组件传递来的数据了。</p> <div class="custom-block tip"><p>值得注意的是，实际上我们无需在组件的构建函数中手动接收 props 然后再传给 super 函数也可以直接访问 this.props，因为 React 实际上会主动将 props 传递给 Component。</p></div> <p>在子组件中也可以对父组件传递来的参数的类型进行校验，这里我们需要借用一个第三方库，感兴趣的可以自行了解一下<a href="https://github.com/facebook/prop-types" target="_blank" rel="noopener noreferrer">prop-types<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。首先我们需要安装一下 prop-types</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>yarn add prop<span class="token operator">-</span>types
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后在子组件中引入并使用</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> PropTypes <span class="token keyword">from</span> <span class="token string">'prop-types'</span>

<span class="token keyword">class</span> <span class="token class-name">ChildCpn</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">当前计数：</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>curCount<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//参数校验</span>
ChildCpn<span class="token punctuation">.</span>propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">curCount</span><span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>number<span class="token punctuation">.</span>isRequired<span class="token punctuation">,</span> <span class="token comment">//父组件传递过来的curCount必须是一个数值，且为必传参数</span>
<span class="token punctuation">}</span>
<span class="token comment">//设置默认值</span>
ChildCpn<span class="token punctuation">.</span>defaultProps <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">curCount</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><div class="custom-block danger"><p>值得一提的是，React 规定，任何组件都必须向纯函数一样保护它们的 props 不被更改</p></div> <p>现在我们知道父组件是如何传递参数给子组件以及子组件又是如何接收参数的了，那如果现在这样的一个业务：点击子组件的某个按钮，新增一个对象到 personList 中。这又该如何处理呢？</p> <p>前面讲到过，任何组件都不能修改其 props 对象。所以，我们不能直接修改 this.props.personList。在这里，我们应该采用子组件向父组件传递消息，通知父组件修改 nameList，当 React 检测到 nameList 修改时，会主动更新传入到子组件的 props 对象。</p> <p>那么问题来了，我们如何才能在子组件中告知父组件更新呢。其实在 React 中，<strong>子组件可以通过自定义事件传递数据给父组件。</strong></p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">class</span> <span class="token class-name">ChildCpn</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">当前计数：</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>curCount<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">+5</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">addNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">addNum</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">app</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ChildCpn</span></span>
          <span class="token attr-name">curCount</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">}</span></span>
          <span class="token attr-name">addNum</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleAddNum</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">}</span></span>
        <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">handleAddNum</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> val<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h3 id="祖孙组件通信"><a href="#祖孙组件通信" class="header-anchor">#</a> 祖孙组件通信</h3> <p>前面介绍了父子组件间的通信，但是仅靠这一种方式显然是不够的。假设我们的组件树如下。
<img src="/assets/img/multi_components.834bb12d.png" alt="multi_component"></p> <p>现在组件 A 想向组件 F 传递数据。使用父子组件间的通信，那么组件 A 需要先把数据传递给组件 B，再通过组件 B 传递给组件 F。这当中存在两个问题：一个是组件 B 并不需要这个数据却又不得不充当中途的接力棒、另一个就是当组件嵌套层级非常深的时候，这种传递方式显然是非常不友好的。接下介绍 React 中的第二种通信方式： <strong>祖孙组件通信</strong>。</p> <p>对于祖孙组件间的通信，React 提供了一个共享对象：<strong>Context</strong></p> <p>Context 相关 API：</p> <p>1、React.createContext：创建一个需要共享的 Context 对象。如果一个组件订阅了 Context，那么这个组件会从离自身最近的那个匹配的 Provider 中读取当前的 context 值。</p> <p>2、Context.Provider：每个 Context 对象里面都有一个 React 组件：Provider。这个组件接收一个 value 属性作为共享数据，传递给消费组件，当 Provider 组件的 value 值发生改变时，它内部的所有消费组件都会重新渲染。</p> <p>3、Class.contextType：每一个类组件都会自带一个 context 属性，默认为空对象。将挂载在 class 上的 contextType 属性重新赋值为一个 Context 对象时，类组件上的 context 属性就变成了 Context.Provider 传进来的 value 值。你可以在任何生命周期中访问它，包括 render 函数。</p> <p>4、Context.Consumer：也是一个 React 组件，可以订阅到 context 的变更。由于函数式组件中不存在所谓的 contextType 属性和生命周期函数。这个组件可以帮助我们在函数式组件中共享数据。</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> createContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">const</span> UserContext <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//创建一个Context对象</span>
<span class="token comment">//子孙组件</span>
<span class="token keyword">class</span> <span class="token class-name">Children</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">姓名： </span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span> <span class="token comment">//通过this.context访问</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

Children<span class="token punctuation">.</span>contextType <span class="token operator">=</span> UserContext <span class="token comment">//将类组件的contextType赋值给一个Context对象</span>

<span class="token comment">//父组件</span>
<span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Children</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 祖先组件</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">app</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'tom'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserContext.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Main</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">UserContext.Provider</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>可以看到，在作为祖先组件的 app 没有通过 Main 组件而直接将数据传递给了后代组件 Children 中。类组件中可以通过 this.context 访问祖先组件传递过来的参数，如果是函数式组件呢？函数式组件中可没有 this 实例，更别说 this.context 对象了，这个时候就需要使用到 Context.Consumer 组件了。所以，作为函数式组件，应该使用下面的代码模式来获取数据。</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">Children</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserContext.Consumer</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">姓名： </span><span class="token punctuation">{</span>value<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">UserContext.Consumer</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="全局事件传递"><a href="#全局事件传递" class="header-anchor">#</a> 全局事件传递</h3> <p>上面我们已经介绍了两种组件间的数据通信。但是这两种通信方式都建立在组件间存在直接关系，如果上图中的组件 G 想和组件 B 或者组件 E 通信，仅仅依靠前面两种方式，实现起来还是略微有点麻烦的。所以接下来，我们再介绍一种更为通用的通信方式：<strong>全局事件传递。</strong></p> <p>使用全局事件传递需要依赖 Node 的事件发射器：<a href="https://github.com/browserify/events" target="_blank" rel="noopener noreferrer">events<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。那么首先得安装 events 包</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>yarn add events
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> EventEmitter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'events'</span>

<span class="token keyword">const</span> eventBus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//创建一个发射器</span>

<span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emitEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">传递</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">}</span>
  <span class="token function">emitEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    eventBus<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'showName'</span><span class="token punctuation">,</span> <span class="token string">'tom'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span> <span class="token comment">//触发全局事件，并传递参数</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Children</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//监听全局事件</span>
    eventBus<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token string">'showName'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleShowName<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//取消事件监听</span>
    eventBus<span class="token punctuation">.</span><span class="token function">removeListener</span><span class="token punctuation">(</span><span class="token string">'showName'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleShowName<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Children</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">}</span>
  <span class="token function">handleShowName</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">app</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Main</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Children</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p>上面例子中，Main 组件和 Children 组件是同级组件，它们之间通过全局事件通信，整个过程中只涉及到了相关的两个组件，并且与组件层级无关。事实上，我们很容易发现，全局事件通信比前面两种通信方式更灵活，更通用。</p> <h2 id="样式书写"><a href="#样式书写" class="header-anchor">#</a> 样式书写</h2> <p>你可能已经发现我们之前写的 react 代码都缺少了 css 部分。确实，在 react 中，css 样式的书写一直困扰着前端人员，由于 React 官方并没有统一 css 的书写形式，因此，不同的开发人员有着不同的书写习惯。而且在 React 中，样式的书写的确没有 vue 中那么的灵活。下面，我们将介绍几种常见的 css 书写形式，它们各有千秋，实际开发中，大家也可以按照自己的习惯自行选择。</p> <h3 id="一、内联样式"><a href="#一、内联样式" class="header-anchor">#</a> 一、内联样式</h3> <p>内联样式是 React 官方比较推荐的一种 css 样式写法，在 React 中，可以对元素的 style 属性赋值以添加样式。<strong>style 接收的是一个采用小驼峰命名属性的 JavaScript 对象，而不是 css 字符串。</strong> 并且，内联样式可以引用 state 的状态来动态的设置相关样式。</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">app</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'red'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> h2Style <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>color<span class="token punctuation">,</span> <span class="token comment">//引用组件状态动态的设置样式</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>h2Style<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">hello react</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span><span class="token comment">/*style接收一个对象*/</span><span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'#000'</span><span class="token punctuation">,</span> <span class="token literal-property property">fontSize</span><span class="token operator">:</span> <span class="token string">'30px'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">hello world</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>可以看到，使用内联样式时，组件间的样式不会有冲突，而且还能动态设置样式，这也是为什么 React 官方比较推荐使用内联样式的原因。</p> <p>但是，内联样式也有其致命的缺点。首先，内联样式需要为每个组件书写一遍样式，这就要求书写大量的样式代码，造成代码混乱。其次就是某些样式是无法通过内联样式编写的，比如伪类/伪元素。</p> <h3 id="二、引入-css-文件"><a href="#二、引入-css-文件" class="header-anchor">#</a> 二、引入 css 文件</h3> <p>这里首先要介绍一下如何给 React 元素添加类名。我们知道不管是在原生的 html 元素还是 vue 当中，我们都可以直接给某一元素添加<code>class属性</code>来给元素添加类名。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>hello world<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>但由于 React 组件都是通过 JSX 语法创建的，JSX 是一种 JavaScript 的语法扩展，它包含了 JavaScript 中的所有特性。而 JavaScript 中已经存在了一个创建类组件的关键字: &quot;class&quot;，所以在 React 中，我们通常都是通过给 React 元素添加一个<code>className属性</code>来定义类名。</p> <p>前面讲到，JSX 拥有 JavaScript 的所有特性。所以，我们也可以在 JSX 中像 JavaScript 一样引入 css 文件。</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token comment">/* app.css文件 */</span>
<span class="token selector">.title</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token comment">// app.js文件</span>

<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token comment">//引入外部css文件</span>
<span class="token keyword">import</span> <span class="token string">'./app.css'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">app</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">hello react</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>这种引入外部 css 文件的方式很符合我们日常编码习惯，但是其最大的不足在于样式的权重难以控制，样式之间容易被覆盖，调试起来也是极为不方便的。</p> <h3 id="三、css-modules"><a href="#三、css-modules" class="header-anchor">#</a> 三、CSS modules</h3> <p>css modules 并不是 React 特有的解决方案，所有使用了类似于 webpack 配置环境下都可以使用 css modules。但是，如果在其他项目中使用，那我们需要自己配置，比如我们可以在 <code>webpack.config.js</code>中配置<code>module: true</code>，使项目支持 css modules。</p> <p>不过 React 脚手架已经内置了 css modules 的配置，我们只需要将普通的<code>.css/.less/.sass</code>等文件的文件名都修改成<code>.module.css</code>、<code>.module.less</code>、<code>.module.scss</code>等，之后就可以引入并使用了。</p> <p>我们可以在 app.module.css 文件中</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token comment">/* app.module.css文件 */</span>
<span class="token selector">.title</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>然后，我们就可以在 app.js 中引用 css module 文件了，css module 会暴露一个对象。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> AppStyle <span class="token keyword">from</span> <span class="token string">'./app.module.css'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h2 className<span class="token operator">=</span><span class="token punctuation">{</span>AppStyle<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token operator">&gt;</span>hello react<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>css module 可以解决局部作用域的问题，不会污染全局样式。但是 css module 引用类名时不能使用连字符(.home-title 是不被识别的)，因为 JavaScript 中不识别连字符。另外对于一些需要动态改变的样式，css module 也无法完成，这种情况下依然是需要靠内联模式来完成的。</p> <h3 id="四、css-in-js"><a href="#四、css-in-js" class="header-anchor">#</a> 四、css in js</h3> <p>css in js 指的是一种模式，其中 css 由 JavaScript 生成。这部分功能是由第三方库实现的，目前最为流行的主要有：<a href="https://github.com/styled-components/styled-components" target="_blank" rel="noopener noreferrer">styled-components<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和 <a href="https://github.com/emotion-js/emotion" target="_blank" rel="noopener noreferrer">emotion<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。这里主要介绍 style-components。</p> <p><strong>styled-components 的本质是通过函数的调用，这个函数接收一个对象，最终创建出一个 React 组件，这个组件会被自动添加上一个唯一的 class 和相关的样式</strong></p> <p>首先，我们需要安装 styled-components</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>yarn add styled<span class="token operator">-</span>components
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后就可以向下面那样使用了</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> styled <span class="token keyword">from</span> <span class="token string">'styled-components'</span>
<span class="token comment">// 使用styled调用函数生成一个React组件，并添加样式，由于是React组件，所以返回值的首字母必须大写</span>
<span class="token keyword">const</span> MyDiv <span class="token operator">=</span> styled<span class="token punctuation">.</span><span class="token function">div</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'red'</span><span class="token punctuation">,</span>
  <span class="token string-property property">'.title'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">fontSize</span><span class="token operator">:</span> <span class="token string">'50px'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">app</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>MyDiv<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h2 className<span class="token operator">=</span><span class="token string">&quot;title&quot;</span><span class="token operator">&gt;</span>hello react<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>MyDiv<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><code>styled.标签名</code>是一个函数，该函数会返回一个 react 组件，而这个组件最后会被渲染成 styled 后面接的那个标签。</p> <p>最终上面的代码会被渲染成下面的结构：</p> <p><img src="data:image/png;base64,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" alt="styled_components"></p> <p>可以看见，调用<code>styled.标签名</code>这个函数生成的标签会被自动绑定一个唯一的类，这样就可以避免污染和覆盖了。</p> <p>在 JavaScript 中，模板字符串也可以调用函数。因此上面<code>styled.标签名</code>函数的调用也可以用模板字符串来实现。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> MyDiv <span class="token operator">=</span> styled<span class="token punctuation">.</span>div<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  color: red;
  .title {
    font-size: 50px;
  }
</span><span class="token template-punctuation string">`</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>而且可以看到，使用模板字符串调用<code>styled.标签名</code>函数的传参更符合 css 的写法，所以我们更多的情况会使用模板字符串来调用这个函数。</p> <p>而且，当使用模块字符串调用<code>styled.标签名</code>函数时，我们借助一些特性帮助我们更方便的书写样式。</p> <h4 id="_1、props-属性"><a href="#_1、props-属性" class="header-anchor">#</a> 1、props 属性</h4> <p>通过给 styled 生成的 react 组件传值，然后使用 props 取值，能有效的帮助我们解决动态样式问题。</p> <div class="custom-block tip"><p>获取 props 需要通过${}传入一个插值函数，props 会作为该函数的参数</p></div> <div class="custom-block tip"><p>传递给 styled 生成的 react 组件上的属性会穿透给最后生成的标签</p></div> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> styled <span class="token keyword">from</span> <span class="token string">'styled-components'</span>

<span class="token keyword">const</span> HYInput <span class="token operator">=</span> styled<span class="token punctuation">.</span>input<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  color: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> props<span class="token punctuation">.</span>color<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;
</span><span class="token template-punctuation string">`</span></span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'red'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">HYInput</span></span> <span class="token attr-name">color</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>color<span class="token punctuation">}</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>传递给 HYInput 的 color 和 type 属性最后都会穿透到 input 标签上</p> <p><img src="data:image/png;base64,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" alt="style_components_example"></p> <h4 id="attrs-属性"><a href="#attrs-属性" class="header-anchor">#</a> attrs 属性</h4> <p>styled-components 属性除了通过 props 传递，也可以通过添加 attrs 属性赋予。传递给 attrs 的属性会被直接添加到最后的标签上。</p> <div class="custom-block tip"><p>attrs 也是一个函数，接收一个对象作为参数，并且返回一个函数。所以也可以通过模板字符串调用</p></div> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> styled <span class="token keyword">from</span> <span class="token string">'styled-components'</span>

<span class="token keyword">const</span> HYInput <span class="token operator">=</span> styled<span class="token punctuation">.</span>input<span class="token punctuation">.</span><span class="token function">attrs</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请输入'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  color: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> props<span class="token punctuation">.</span>color<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;
</span><span class="token template-punctuation string">`</span></span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">app</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'red'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">fontSize</span><span class="token operator">:</span> <span class="token string">'16px'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> color<span class="token punctuation">,</span> fontSize <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">HYInput</span></span> <span class="token attr-name">color</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>color<span class="token punctuation">}</span></span> <span class="token attr-name">fontSize</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>fontSize<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h4 id="_3、继承"><a href="#_3、继承" class="header-anchor">#</a> 3、继承</h4> <p>假如有两个组件的样式如下：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">const</span> HYButton <span class="token operator">=</span> styled<span class="token punctuation">.</span>button<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  padding: 10px 20px;
  border-color: red;
  color: #fff;
</span><span class="token template-punctuation string">`</span></span>
<span class="token keyword">const</span> HYPrimaryButton <span class="token operator">=</span> styled<span class="token punctuation">.</span>button<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  padding: 10px 20px;
  border-color: red;
  color: green;
</span><span class="token template-punctuation string">`</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>这两个组件的样式非常相似，仅仅只是字体颜色不同，如果按照上面的形式书写，未免太冗余了。此时我们就可以使用 styled-components 的另一个特性： 继承。</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> styled <span class="token keyword">from</span> <span class="token string">'styled-components'</span>

<span class="token keyword">const</span> HYButton <span class="token operator">=</span> styled<span class="token punctuation">.</span>button<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  padding: 10px 20px;
  border-color: red;
  color: #fff;
</span><span class="token template-punctuation string">`</span></span>
<span class="token comment">//HYPrimaryButton继承HYButton的样式，同样是生成button按钮</span>
<span class="token keyword">const</span> HYPrimaryButton <span class="token operator">=</span> <span class="token function">styled</span><span class="token punctuation">(</span>HYButton<span class="token punctuation">)</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  color: green;
</span><span class="token template-punctuation string">`</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="custom-block warning"><p>只有最后生成的是同类型的标签才能使用继承</p></div> <h4 id="_4、主题"><a href="#_4、主题" class="header-anchor">#</a> 4、主题</h4> <p>一个工程中可能存在一部分样式是全局样式，即，大部分标签都会使用到这些样式。那么我们可以将这部分样式写成主题，这样所有的标签都可以使用主题中的样式，而且日后维护起来也是非常的方便。</p> <p>使用主题需要从 styled-components 中引入 ThemeProvider(一个 react 组件)，并且传入一个 theme 属性(一个对象)。同样可以通过 props 在调用<code>styled.标签名</code>函数时获取。</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> styled<span class="token punctuation">,</span> <span class="token punctuation">{</span> ThemeProvider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'styled-components'</span>

<span class="token keyword">const</span> DivStyle <span class="token operator">=</span> styled<span class="token punctuation">.</span>div<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  color: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> props<span class="token punctuation">.</span>theme<span class="token punctuation">.</span>color<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;
</span><span class="token template-punctuation string">`</span></span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">app</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ThemeProvider</span></span> <span class="token attr-name">theme</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token literal-property property">fontSize</span><span class="token operator">:</span> <span class="token string">'20px'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">DivStyle</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">hello react</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">DivStyle</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">ThemeProvider</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="添加-class"><a href="#添加-class" class="header-anchor">#</a> 添加 class</h2> <p>由于 class 是 JavaScript 中的关键字，所以 react 中是通过给 className 传递一个字符串来添加类名的。</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">app</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">isbbb</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> isbbb <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
    <span class="token keyword">const</span> classList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'aaa'</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isbbb<span class="token punctuation">)</span> classList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>'bbb<span class="token punctuation">)</span>
    <span class="token keyword">const</span> classname <span class="token operator">=</span> classList<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">

        </span><span class="token punctuation">{</span><span class="token comment">/*写法一*/</span><span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>aaa<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">hello react</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">

        </span><span class="token punctuation">{</span><span class="token comment">/*写法二*/</span><span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>isbbb <span class="token operator">?</span> <span class="token string">'bbb'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">hello world</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">

        </span><span class="token punctuation">{</span><span class="token comment">/*写法三*/</span><span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">aaa </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>isbbb <span class="token operator">?</span> <span class="token string">'bbb'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">hello heihei</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">

        </span><span class="token punctuation">{</span><span class="token comment">/*写法四*/</span><span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>classname<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">hello haha</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>对于简单的类名而言，上面的写法足够了，但是如果一个元素的有许多动态类，那么在这个元素上会写许多的三元运算，这样对于后期的维护肯定是不友好的。这个时候我们可以使用一个第三方库：<a href="https://github.com/JedWatson/classnames" target="_blank" rel="noopener noreferrer">classnames<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>安装</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>yarn add classnames
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>引入</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> classNames <span class="token keyword">from</span> <span class="token string">'classnames'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="custom-block tip"><p>引入的 classNames 是一个函数，这个函数接收的参数可以是字符串、对象、数组，当然也可以是这几种数据类型的混合。用的最多的还是传一个对象。这个函数的返回值是一个字符串</p></div> <p><strong>使用</strong></p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> PureComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> classNames <span class="token keyword">from</span> <span class="token string">'classnames'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">app</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">isActive</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">classNames</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">active</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>isActive <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          我是标题
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h2 id="补充"><a href="#补充" class="header-anchor">#</a> 补充</h2> <h3 id="purecomponent"><a href="#purecomponent" class="header-anchor">#</a> PureComponent</h3> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Child被更新'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Child</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">app</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'hello world'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'app被更新'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>message<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Child</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">改变</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">changeMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'hello react'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>上面的代码好像没啥问题，然而当我们点击按钮时，发现即使我们改变的仅仅是 app 组件当中的状态，但 Child 组件的 render 函数也会重新执行。即，日志中会同时打印：<code>app被更新</code>, <code>child被更新</code>。</p> <p>在 react 当中，如果某棵嵌套组织树如下，当我们改变 app 组件中的某个状态时，所有组件的 render 函数都会重新执行一遍，性能势必也会下降。事实上，这种情况下，很多组件没必要重新执行它们的 render 函数。<strong>一个组件的 render 函数是否要重新执行应该有一个前提，就是组件所依赖的数据(state、props)发生改变。</strong></p> <p><img src="data:image/png;base64,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" alt="component_tree"></p> <p>那我们如何控制组件的 render 函数不受其他组件影响呢？其实，react 早就想到了这一点，所以在 react 中导出了另一个类：<strong>PureComponent</strong></p> <p>在 PureComponent 中，react 已经替我们完成了 shouldComponentUpdate 函数中的判断，而且 PureComponent 继承 Component 类，拥有 Component 类中的所有属性和方法。既然这样，前面的代码就可以进一步优化。</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> PureComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Child被更新'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Child</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">app</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'hello world'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'app被更新'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>message<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Child</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">改变</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">changeMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'hello react'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>经过优化后的代码，点击按钮后，虽然 app 组件的状态发生了改变，但是由于 Child 组件的状态没有发生变化且不依赖 App 组件中的任何状态，即 Child 的 state 和 props 均未发生变化，因此不会重新执行 render 函数。</p> <div class="custom-block warning"><p>注意，继承了 PureComponent 的组件是不允许再调用 shouldComponentUpdate 函数的了，因为 PureComponent 会重写组件的 shouldComponentUpdate 方法</p></div> <h3 id="memo"><a href="#memo" class="header-anchor">#</a> memo</h3> <p>类组件可以通过继承 PureComponent 来优化是否需要更新组件，但是如果是函数式组件呢？肯定不能通过继承 PureComponent 来实现，因为 PureComponent 本质上是 React 内调用了 shouldComponentUpdate 生命周期函数来判断是否需要调用 render 函数，而函数式组件中是没有生命周期。</p> <p>事实上，函数式组件是通过 memo 来优化是否需要更新组件的。memo 是一个高阶组件，这个高阶组件接受一个组件作为参数，并返回一个 React 组件。</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> PureComponent<span class="token punctuation">,</span> memo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">const</span> MemoMain <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'main 组件'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">main 组件</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">app</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MemoMain</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">改变</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>上面代码的效果和类组件继承 PureComponent 是一样的，点击按钮，app 组件的 render 函数会执行，但是 Main 组件中的函数不会执行。</p> <h3 id="ref"><a href="#ref" class="header-anchor">#</a> ref</h3> <p>在 react 中，可以通过 ref 来获取对应的 DOM 节点。主要有以下三种方式：</p> <p><strong>方式一：字符串方式。</strong></p> <p>给元素赋值一个字符串的 ref 属性，然后通过<code>this.refs.属性名</code>的可以获取到对应的 DOM 节点。这种方式官方已经不推荐了，并且在以后的版本中可能会被删除。</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> PureComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">app</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>titleRef<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">hello world</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeVal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">改变</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">changeVal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>refs<span class="token punctuation">.</span>titleRef<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'hello react'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>方式二、对象方式。</strong></p> <p>通过<code>React.createRef( )</code>的方式创建一个对象，然后将这个对象赋值给元素的 ref 属性。使用时，直接通过访问这个对象的<code>current属性</code>就可以获取到对应的 DOM 节点。这种方式是 React 官方目前推荐的方式。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> PureComponent<span class="token punctuation">,</span> createRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">app</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>titleRef <span class="token operator">=</span> <span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h2 ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>titleRef<span class="token punctuation">}</span><span class="token operator">&gt;</span>hello world<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeVal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>改变<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">changeVal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>titleRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'hello react'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><strong>方式三、函数方式。</strong></p> <p>我们还可以向 DOM 节点的 ref 属性传入一个函数，该函数会在 DOM 节点被挂载时进行回调。这个函数会传入一个元素对象，我们可以自己保存；使用时，直接拿到之前保存的元素对象即可。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> PureComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">app</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>titleRef <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h2 ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>titleRef <span class="token operator">=</span> arg<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>hello world<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeVal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>改变<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">changeVal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>titleRef<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'hello react'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><div class="custom-block tip"><p>注意：不能在函数式组件上使用 ref 属性，因为函数式组件没有 this 实例</p></div> <p>既然我们无法在函数式组件上使用 ref 属性，那如果我们想要获取对应的组件对象呢？此时，我们就需要使用高阶组件来转发 ref，这个高阶组件就是<code>React.forwardRef</code></p> <p>这里提到一个新概念 ---- 高阶组件。什么是高阶组件呢？我们可以先看看高阶函数的定义。接收一个或多个函数作为参数并返回一个函数的的函数称为高阶函数。同理。高阶组件的参数是一个组件，返回值同样也是一个新组件的函数，高阶组件的英文是：Higher-Order Components，简称 HOC。</p> <p>我们可以进行如下解析：</p> <ul><li>首先，高阶组件本身并不是一个组件，而纯粹是一个函数。</li> <li>其次，这个函数的参数是一个组件，返回值也是一个组件。</li></ul> <p>ref 转发就是通过类组件创建一个 ref 对象，然后传递给子组件(函数式组件)。这样，函数式组件中就可以使用 ref 了。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> PureComponent<span class="token punctuation">,</span> createRef<span class="token punctuation">,</span> forwardRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">const</span> Child <span class="token operator">=</span> <span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>h2 ref<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span><span class="token operator">&gt;</span>hello react<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">app</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>titleRef <span class="token operator">=</span> <span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Child ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>titleRef<span class="token punctuation">}</span> name<span class="token operator">=</span><span class="token string">&quot;tom&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="fragment"><a href="#fragment" class="header-anchor">#</a> Fragment</h3> <p>jsx 语法要求必须且只能返回一个根元素，例如下面的 jsx 语法中返回了一个 div 根元素。</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">hello world</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>message <span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>但其实这个 div 并没有任何实质性的作用，因此 react 引入了 Fragment 的概念来充当根元素。Fragment 的作用类似于 vue 中的 template，当 react 遇到 Fragment 时，不会渲染出任何额外的 DOM 节点，从而提高性能。</p> <h3 id="protals"><a href="#protals" class="header-anchor">#</a> Protals</h3> <p>某些情况下，我们希望渲染的内容独立于父组件，甚至独立于当前挂载的 DOM 元素中(默认都是挂载到 id 为 root 的 DOM 元素上)。比如 dialog 弹框，通常我们希望它脱离其父组件而总是位于可视窗口的中间。而 Protals 就提供了这样的一种将子节点渲染到脱离父组件之外的 DOM 节点的优秀方案。</p> <p>Protals 的本质仍然是一个 React 组件，只不过这个组件不是以我们之前介绍的类组件或函数式组件的创建方式创建的，而是通过调用<code>ReactDom.createPortal</code>函数生成的。
这个函数接收两个参数：</p> <ul><li><p>1、要渲染在 Protals 中的 React 子元素，可以是一个元素、字符串或者 fragment；</p></li> <li><p>2、Protals 挂载的 DOM 元素</p></li></ul> <p><strong>使用步骤：</strong></p> <p>1、修改 public/index.html 文件，添加 protals 挂载的节点
<img src="/assets/img/protals_parent_dom.f75bb06d.png" alt="protals_parent_dom"></p> <p>2、编写节点样式
<img src="/assets/img/protals_css.86fb2667.png" alt="protals_css"></p> <p>3、编写组件代码</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> PureComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> ReactDom <span class="token keyword">from</span> <span class="token string">'react-dom'</span>

<span class="token keyword">class</span> <span class="token class-name">Modal</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> ReactDom<span class="token punctuation">.</span><span class="token function">createPortal</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">,</span>
      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'modal'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">app</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Modal</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">hello world</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Modal</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="react-transition-group"><a href="#react-transition-group" class="header-anchor">#</a> react-transition-group</h3> <p>在开发中，我们想要给一个组件的显示和消失添加某种过渡动画，以增加用户体验。当然，我们可以通过原生的 css 来实现这些动画，但是 React 社区同样也为我们提供了<a href="https://reactcommunity.org/react-transition-group/" target="_blank" rel="noopener noreferrer">react-transition-group<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，用来完成过渡动画。这个库可以帮助我们方便的实现组件的入场和离场动画。</p> <div class="custom-block tip"><p>react-transition-group 主要由以下四个组件组成：</p> <p>1、Transition：该组件是一个和平台无关的组件，在前端开发中，我们一般是结合 CSS 来完成过渡动画，所以笔记常用的是 CSSTransition。</p> <p>2、CSSTransition：完成过渡动画效果。</p> <p>3、SwitchTransition：完成两个组件显示和隐藏切换动画。</p> <p>4、TransitionGroup：将多个动画包裹其中，一般用于列表中元素的动画。</p></div> <h4 id="csstransition"><a href="#csstransition" class="header-anchor">#</a> CSSTransition</h4> <p>CSSTransition 是基于 Transition 组件构建的，<strong>它只允许包裹一个根元素。</strong></p> <p>CSSTransition 执行过程中，有三个状态：appear、enter、exit。</p> <p>它们有三种状态，需要定义对应的 css 样式：</p> <p>开始状态：对应的类是 <code>-appear</code>、<code>-enter</code>、<code>-exit</code>；</p> <p>执行动画：对应的类是 <code>-appear-active</code>、<code>-enter-active</code>、<code>-exit-active</code>；</p> <p>执行结束：对应的类是 <code>-appear-done</code>、<code>-enter-done</code>、<code>-exit-done</code>；</p> <p><strong>CSSTransition 常见对应的属性：</strong></p> <p>in：触发进入或者退出状态，通常是一个布尔值。</p> <div class="custom-block tip"><p>当 in 为 true 时，触发进入状态，添加<code>-enter</code>、<code>-enter-active</code>的类名，并开始执行动画，当动画结束后，会移除这两个类名并添加<code>-enter-done</code>的类名。</p> <p>当 in 为 false 时，触发退出状态，添加<code>-exit</code>、<code>-exit-active</code>的类名，并开始执行动画，当动画结束后，会移除这两个类名并添加<code>-exit-done</code>的类名。</p></div> <p>classNames：动画 class 的名称，决定了在编写 css 时，对应的 class 名称，比如 card-enter、card-enter-active、card-enter-done。</p> <p>timeout：classNames 添加的时间，该属性并不会控制动画执行的时间，动画执行的时间是由 css 中的属性控制的。</p> <p>appear：是否在初次进入添加动画(需要和 in 同时为 true)。</p> <p>unmountOnExit：退出后卸载组件。当<code>unmountOnExit={ false }</code>时，组件的过渡仅仅是操作 css，即仅仅是隐藏组件，该组件并没有从 DOM 树上去除且依旧占据原来的位置；当<code>unmountOnExit={ true }</code>时，组件退出后会从 DOM 树上去除。默认是 false。</p> <p><strong>CSSTransition 常见的钩子函数：</strong>
onEnter：在进入动画之前被触发</p> <p>onEntering：在应用进入动画时被触发</p> <p>onEntered：在应用进入动画结束后被触发</p> <p>onExit：在退出动画之前被触发</p> <p>onExiting：在应用退出动画时被触发</p> <p>onExited：在应用退出动画结束后被触发</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token comment">//app.js</span>

<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> PureComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> CSSTransition <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-transition-group'</span>
<span class="token keyword">import</span> <span class="token string">'./app.css'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">isShow</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> isShow <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">显示/隐藏</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">CSSTransition</span></span>
          <span class="token attr-name">in</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>isShow<span class="token punctuation">}</span></span>
          <span class="token attr-name">classNames</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>card<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">timeout</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token number">300</span><span class="token punctuation">}</span></span>
          <span class="token attr-name">onEnter</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'开始进入'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
        <span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>box<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">CSSTransition</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">changState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">isShow</span><span class="token operator">:</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>isShow<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token comment">/* app.css */</span>

<span class="token selector">.box</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.card-enter</span> <span class="token punctuation">{</span>
  <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>0.4<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.card-enter-active</span> <span class="token punctuation">{</span>
  <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">transition</span><span class="token punctuation">:</span> all 300ms<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.card-exit</span> <span class="token punctuation">{</span>
  <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.card-exit-active</span> <span class="token punctuation">{</span>
  <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>0.4<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">transition</span><span class="token punctuation">:</span> all 300ms<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.card-exit-done</span> <span class="token punctuation">{</span>
  <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h3 id="switchtransition"><a href="#switchtransition" class="header-anchor">#</a> SwitchTransition</h3> <p>SwitchTransition 可以完成两个组件之间切换的炫酷动画。比如我们有一个按钮，需要在 on 和 off 之间切换，并且希望看到 on 先从左边退出，off 再从右边进入。这个动画在 vue 中被称为 vue transition modes，而 react-transition-group 中使用 SwitchTransition 来实现该动画。</p> <p>SwitchTransition 中主要有一个属性：mode，这个属性有两个值：</p> <ul><li>in-out：表示新组件先进入，旧组件再移除</li> <li>out-in：表示旧组件先移除，新组件再进入</li></ul> <div class="custom-block tip"><p>SwitchTransition 组件里面要有 CSSTransition 或者 Transition 组件，不能直接包裹要切换的组件</p> <p>SwitchTransition 里面的 CSSTransition 或 Transition 组件不再像以前那样接收 in 属性来判断元素是何种状态，取而代之的是 key 属性</p> <p>SwitchTransition 与 CSSTransition 的区别在于：CSSTransition 只能控制元素的显示和隐藏或者其他的 css 属性；而 SwitchTransition 不仅控制 css 属性还能改变显示的文本</p></div> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token comment">// app.js</span>

<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> PureComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> CSSTransition<span class="token punctuation">,</span> SwitchTransition <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-transition-group'</span>
<span class="token keyword">import</span> <span class="token string">'./app.css'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">isOn</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> isOn <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">SwitchTransition</span></span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>out-in<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">CSSTransition</span></span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>isOn<span class="token punctuation">}</span></span> <span class="token attr-name">timeout</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token number">1000</span><span class="token punctuation">}</span></span> <span class="token attr-name">classNames</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>card<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
              </span><span class="token punctuation">{</span>isOn <span class="token operator">?</span> <span class="token string">'on'</span> <span class="token operator">:</span> <span class="token string">'off'</span><span class="token punctuation">}</span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">CSSTransition</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">SwitchTransition</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">changState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">isOn</span><span class="token operator">:</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>isOn<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token comment">/* app.css */</span>

<span class="token selector">.card-enter</span> <span class="token punctuation">{</span>
  <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>50%<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.card-enter-active</span> <span class="token punctuation">{</span>
  <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">transition</span><span class="token punctuation">:</span> all 1000ms<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.card-exit</span> <span class="token punctuation">{</span>
  <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.card-exit-active</span> <span class="token punctuation">{</span>
  <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>-50%<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">transition</span><span class="token punctuation">:</span> all 1000ms<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="transitiongroup"><a href="#transitiongroup" class="header-anchor">#</a> TransitionGroup</h3> <p>当我们有一组 CSSTransition 时，需要将这些 CSSTransition 统一放入到一个 TransitionGroup 中来完成动画。</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">TransitionGroup</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">CSSTransition</span></span> <span class="token attr-name">classNames</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>friend<span class="token punctuation">&quot;</span></span> <span class="token attr-name">timeout</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token number">300</span><span class="token punctuation">}</span></span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">CSSTransition</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">TransitionGroup</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></div> <footer class="page-edit" style="display:none;"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">1/1/2023, 4:10:51 PM</span></div></footer> <!----> <!----></main> <!----> <div class="comments-wrapper" data-v-4698c43e><!----></div></div></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-44bd5a18 data-v-44bd5a18><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-44bd5a18><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-44bd5a18></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-44bd5a18></path></svg></div><!----><div></div><!----><div class="reco-bgm-panel" data-v-b1d3339e><audio id="bgm" src="https://music.163.com/song/media/outer/url?id=316756.mp3" data-v-b1d3339e></audio> <div class="reco-float-box" style="bottom:200px;z-index:999999;display:none;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><img src="https://p2.music.126.net/qOOTIykbSLw9RHB0vI83GA==/737772302281958.jpg" data-v-b1d3339e></div> <div class="reco-bgm-box" style="left:10px;bottom:10px;z-index:999999;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="reco-bgm-cover" style="background-image:url(https://p2.music.126.net/qOOTIykbSLw9RHB0vI83GA==/737772302281958.jpg);" data-v-b1d3339e><div class="mini-operation" style="display:none;" data-v-b1d3339e><i class="reco-bgm reco-bgm-pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play" style="display:none;" data-v-b1d3339e></i></div> <div class="falut-message" style="display:none;" data-v-b1d3339e>
          播放失败
        </div></div> <div class="reco-bgm-info" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-music music" data-v-b1d3339e></i>大城小事</div> <div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-artist" data-v-b1d3339e></i>杨千嬅</div> <div class="reco-bgm-progress" data-v-b1d3339e><div class="progress-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div> <div class="reco-bgm-operation" data-v-b1d3339e><i class="reco-bgm reco-bgm-last last" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-pause pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play play" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-next next" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-volume1 volume" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-mute mute" style="display:none;" data-v-b1d3339e></i> <div class="volume-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div></div> <div class="reco-bgm-left-box" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><i class="reco-bgm reco-bgm-left" data-v-b1d3339e></i></div></div></div></div></div>
    <script src="/assets/js/app.b627ab70.js" defer></script><script src="/assets/js/4.b7ac1ab4.js" defer></script><script src="/assets/js/1.9d26e7c2.js" defer></script><script src="/assets/js/10.a2a3a23e.js" defer></script><script src="/assets/js/16.d6e6d53e.js" defer></script>
  </body>
</html>
